# Voting Flow Tests

このディレクトリには、投票機能に関するE2Eテストが含まれます。

## テストファイル

### vote-submission.spec.ts

次の一手候補への投票機能のテスト:

- 次の一手候補の表示テスト
- 候補の選択と投票送信テスト
- 成功確認メッセージの表示検証
- 投票済み表示の検証
- パフォーマンステスト（45秒以内）

### vote-validation.spec.ts

投票バリデーション機能のテスト:

- 同じ投票期間中の重複投票エラーテスト
- 投票期間終了後の投票エラーテスト
- パフォーマンステスト（45秒以内）

### candidate-submission.spec.ts

新しい候補の投稿機能のテスト:

- 新しい候補の投稿テスト
- 候補の説明文表示検証
- 無効なデータでの候補投稿エラーテスト（空の説明文）
- 説明文が200文字を超える場合のエラーテスト
- 投稿した候補が一覧に表示されることの検証
- パフォーマンステスト（45秒以内）

## 要件カバレッジ

これらのテストは、仕様書の以下の要件をカバーしています:

### 要件4: 投票フローのテスト

- 4.1: 次の一手候補が表示されることを検証 ✓
- 4.2: 投票送信後の成功確認が表示されることを検証 ✓
- 4.3: 同じ投票期間中の重複投票のエラーメッセージを検証 ✓
- 4.4: 候補の説明文が表示されることを検証 ✓
- 4.5: 投稿した候補が候補一覧に表示されることを検証 ✓
- 4.6: 無効な候補データのエラーメッセージを検証 ✓

### 要件8: テスト実行パフォーマンス

- 8.3: 単一の投票フローテストが45秒以内に完了すること ✓

## テストの実行

```bash
# すべての投票テストを実行
pnpm test:e2e voting/

# 特定のテストファイルを実行
pnpm test:e2e voting/vote-submission.spec.ts

# UIモードでデバッグ実行
pnpm test:e2e:ui voting/

# ヘッドモードで実行
pnpm test:e2e:headed voting/
```

## テストデータ

テストは以下のフィクスチャを使用します:

- `authenticatedUser`: 認証済みページとテストユーザーを提供
- `testGame`: アクティブ状態のテストゲームを提供
- `createTestCandidate()`: テスト用の次の一手候補を作成するヘルパー

## 注意事項

- すべてのテストに45秒以内に完了することを確認するパフォーマンスチェックが含まれています
- テストは実行後に自動的にテストデータをクリーンアップします
- テストは保守性のためにPage Object Model（VotingPage）を使用しています
- テストは成功シナリオとエラーシナリオの両方を検証します
