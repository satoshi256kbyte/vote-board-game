#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üß™ Running tests..."
if ! pnpm test; then
  echo "‚ùå Tests failed"
  exit 1
fi

echo "‚úÖ Tests passed"
echo ""

echo "üîç Running type check..."
if ! pnpm type-check; then
  echo "‚ùå Type check failed"
  exit 1
fi

echo "‚úÖ Type check passed"
echo ""

echo "üîé Running lint..."
if ! pnpm lint; then
  echo "‚ùå Lint failed"
  exit 1
fi

echo "‚úÖ Lint passed"
echo ""

echo "üõ°Ô∏è  Running CDK security check (cdk-nag)..."
if ! pnpm --filter @vote-board-game/infra synth > /dev/null 2>&1; then
  echo "‚ùå CDK security check failed"
  echo ""
  echo "Running synth again to show errors:"
  pnpm --filter @vote-board-game/infra synth
  exit 1
fi

echo "‚úÖ CDK security check passed"
echo ""
echo "‚ú® All checks passed! Pushing to remote..."


