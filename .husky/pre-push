#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ“ Running format check..."
if ! pnpm format:check; then
  echo "âŒ Format check failed"
  echo "Run 'pnpm format' to fix formatting issues"
  exit 1
fi

echo "âœ… Format check passed"
echo ""

echo "ğŸ“„ Running markdown lint..."
if ! pnpm lint:md; then
  echo "âŒ Markdown lint failed"
  echo "Run 'pnpm lint:md:fix' to fix markdown issues"
  exit 1
fi

echo "âœ… Markdown lint passed"
echo ""

echo "ğŸ” Running type check..."
if ! pnpm type-check; then
  echo "âŒ Type check failed"
  exit 1
fi

echo "âœ… Type check passed"
echo ""

echo "ğŸ” Running lint..."
if ! pnpm lint; then
  echo "âŒ Lint failed"
  exit 1
fi

echo "âœ… Lint passed"
echo ""

echo "ğŸ›¡ï¸  Running CDK security check (cdk-nag)..."
if ! pnpm --filter @vote-board-game/infra synth > /dev/null 2>&1; then
  echo "âŒ CDK security check failed"
  echo ""
  echo "Running synth again to show errors:"
  pnpm --filter @vote-board-game/infra synth
  exit 1
fi

echo "âœ… CDK security check passed"
echo ""

echo "ğŸ§ª Running tests..."
if ! pnpm test; then
  echo "âŒ Tests failed"
  exit 1
fi

echo "âœ… Tests passed"
echo ""

echo "âœ¨ All checks passed! Pushing to remote..."


