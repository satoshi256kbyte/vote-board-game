# 要件定義書

## はじめに

本ドキュメントは、投票ボードゲームアプリケーションのプロフィール関連画面機能の要件を定義します。プロフィール画面は、ユーザーが自分のプロフィール情報（ユーザー名、アイコン画像）を表示・編集できるようにするフロントエンド機能です。この画面は、既存のプロフィールAPI（spec 11-profile-api）と統合し、Next.js 16 App Router、shadcn/ui、Tailwind CSSを使用して実装されます。

## 用語集

- **プロフィール表示画面**: ユーザーのプロフィール情報を表示するUIコンポーネント
- **プロフィール編集画面**: ユーザーがプロフィール情報を編集するUIコンポーネント
- **プロフィールAPI**: バックエンドのプロフィール管理エンドポイント（`/profile`）
- **アイコン画像**: ユーザーのプロフィールアイコン（PNG、JPEG、GIF形式、最大5MB）
- **Presigned_URL**: S3への一時的なアップロード権限を持つURL
- **アクセストークン**: API認証用のJWTトークン
- **フォームバリデーション**: ユーザー入力の妥当性をクライアント側で検証する処理
- **エラーメッセージ**: バリデーションエラーまたはAPI呼び出しエラーをユーザーに表示するテキスト
- **ローディング状態**: API呼び出し中であることを示すUI状態

## 要件

### 要件1: プロフィール表示画面の表示

**ユーザーストーリー:** 認証済みユーザーとして、自分のプロフィール情報を確認したい。

#### 受け入れ基準

1. プロフィール表示画面がマウントされたとき、プロフィール表示画面は、プロフィールAPIにGETリクエストを送信しなければならない
2. プロフィールAPIからレスポンスを受信したとき、プロフィール表示画面は、ユーザー名を表示しなければならない
3. プロフィールAPIからレスポンスを受信したとき、プロフィール表示画面は、メールアドレスを表示しなければならない
4. プロフィールAPIからレスポンスを受信したとき、プロフィール表示画面は、アイコン画像を表示しなければならない
5. アイコン画像が設定されていない場合、プロフィール表示画面は、デフォルトのアバターアイコンを表示しなければならない
6. プロフィール表示画面は、「編集」ボタンを表示しなければならない

### 要件2: プロフィール編集画面への遷移

**ユーザーストーリー:** ユーザーとして、プロフィール情報を編集するために編集画面に移動したい。

#### 受け入れ基準

1. 「編集」ボタンをクリックしたとき、プロフィール表示画面は、ユーザーをプロフィール編集画面（`/profile/edit`）に遷移させなければならない

### 要件3: プロフィール編集フォームの表示

**ユーザーストーリー:** ユーザーとして、現在のプロフィール情報を確認しながら編集したい。

#### 受け入れ基準

1. プロフィール編集画面がマウントされたとき、プロフィール編集画面は、プロフィールAPIにGETリクエストを送信しなければならない
2. プロフィールAPIからレスポンスを受信したとき、プロフィール編集画面は、ユーザー名入力フィールドに現在のユーザー名を表示しなければならない
3. プロフィール編集画面は、アイコン画像のプレビューを表示しなければならない
4. プロフィール編集画面は、「画像を選択」ボタンを表示しなければならない
5. プロフィール編集画面は、「保存」ボタンを表示しなければならない
6. プロフィール編集画面は、「キャンセル」ボタンを表示しなければならない

### 要件4: ユーザー名のバリデーション

**ユーザーストーリー:** ユーザーとして、ユーザー名を正しい形式で入力し、エラーを事前に確認したい。

#### 受け入れ基準

1. ユーザー名フィールドが空の状態で「保存」ボタンをクリックしたとき、プロフィール編集画面は、エラーメッセージ「ユーザー名を入力してください」を表示しなければならない
2. ユーザー名が50文字を超える状態で「保存」ボタンをクリックしたとき、プロフィール編集画面は、エラーメッセージ「ユーザー名は50文字以内で入力してください」を表示しなければならない
3. バリデーションエラーが存在する場合、プロフィール編集画面は、プロフィールAPIを呼び出してはならない

### 要件5: アイコン画像の選択とプレビュー

**ユーザーストーリー:** ユーザーとして、アイコン画像を選択し、アップロード前にプレビューを確認したい。

#### 受け入れ基準

1. 「画像を選択」ボタンをクリックしたとき、プロフィール編集画面は、ファイル選択ダイアログを表示しなければならない
2. ファイル選択ダイアログは、PNG、JPEG、GIF形式のファイルのみを選択可能にしなければならない
3. ファイルが選択されたとき、プロフィール編集画面は、選択された画像のプレビューを表示しなければならない
4. ファイルサイズが5MBを超える場合、プロフィール編集画面は、エラーメッセージ「画像サイズは5MB以下にしてください」を表示しなければならない
5. サポートされていないファイル形式が選択された場合、プロフィール編集画面は、エラーメッセージ「PNG、JPEG、GIF形式の画像を選択してください」を表示しなければならない

### 要件6: アイコン画像のアップロード

**ユーザーストーリー:** ユーザーとして、選択したアイコン画像をアップロードし、プロフィールに反映させたい。

#### 受け入れ基準

1. 画像が選択された状態で「保存」ボタンをクリックしたとき、プロフィール編集画面は、プロフィールAPIにPOSTリクエストを送信してPresigned_URLを取得しなければならない
2. Presigned_URLを取得したとき、プロフィール編集画面は、選択された画像をS3にアップロードしなければならない
3. S3へのアップロードが成功したとき、プロフィール編集画面は、プロフィールAPIにPATCHリクエストを送信してiconUrlを更新しなければならない
4. S3へのアップロードが失敗したとき、プロフィール編集画面は、エラーメッセージ「画像のアップロードに失敗しました。再度お試しください」を表示しなければならない

### 要件7: プロフィール情報の更新

**ユーザーストーリー:** ユーザーとして、編集したプロフィール情報を保存したい。

#### 受け入れ基準

1. すべてのバリデーションが通過した状態で「保存」ボタンをクリックしたとき、プロフィール編集画面は、更新されたユーザー名を含むPATCHリクエストをプロフィールAPIに送信しなければならない
2. プロフィールAPIリクエストを送信している間、プロフィール編集画面は、「保存」ボタンを無効化しなければならない
3. プロフィールAPIリクエストを送信している間、プロフィール編集画面は、ローディングインジケーター（スピナーまたは「保存中...」テキスト）を表示しなければならない
4. プロフィールAPIリクエストを送信している間、プロフィール編集画面は、フォーム入力フィールドを無効化しなければならない

### 要件8: プロフィール更新成功時の処理

**ユーザーストーリー:** ユーザーとして、プロフィール更新が成功したら、更新された情報を確認したい。

#### 受け入れ基準

1. プロフィールAPIが200ステータスコードを返したとき、プロフィール編集画面は、成功メッセージ「プロフィールを更新しました」を表示しなければならない
2. プロフィール更新が成功したとき、プロフィール編集画面は、ユーザーをプロフィール表示画面（`/profile`）にリダイレクトしなければならない

### 要件9: プロフィール更新失敗時のエラー表示

**ユーザーストーリー:** ユーザーとして、プロフィール更新に失敗した場合、その理由を明確に理解し、適切に対処したい。

#### 受け入れ基準

1. プロフィールAPIが400ステータスコードを返したとき、プロフィール編集画面は、APIから返されたバリデーションエラーメッセージを表示しなければならない
2. プロフィールAPIが401ステータスコードを返したとき、プロフィール編集画面は、エラーメッセージ「認証エラーが発生しました。再度ログインしてください」を表示しなければならない
3. プロフィールAPIが500ステータスコードを返したとき、プロフィール編集画面は、エラーメッセージ「サーバーエラーが発生しました。しばらくしてから再度お試しください」を表示しなければならない
4. ネットワークエラーが発生したとき、プロフィール編集画面は、エラーメッセージ「ネットワークエラーが発生しました。インターネット接続を確認してください」を表示しなければならない
5. エラーメッセージを表示したとき、プロフィール編集画面は、「保存」ボタンとフォーム入力フィールドを再度有効化しなければならない

### 要件10: 編集のキャンセル

**ユーザーストーリー:** ユーザーとして、編集内容を破棄してプロフィール表示画面に戻りたい。

#### 受け入れ基準

1. 「キャンセル」ボタンをクリックしたとき、プロフィール編集画面は、ユーザーをプロフィール表示画面（`/profile`）にリダイレクトしなければならない
2. フォームに未保存の変更がある状態で「キャンセル」ボタンをクリックしたとき、プロフィール編集画面は、確認ダイアログ「変更内容が保存されていません。破棄してもよろしいですか？」を表示しなければならない
3. 確認ダイアログで「はい」を選択したとき、プロフィール編集画面は、ユーザーをプロフィール表示画面にリダイレクトしなければならない
4. 確認ダイアログで「いいえ」を選択したとき、プロフィール編集画面は、編集画面に留まらなければならない

### 要件11: ローディング状態の表示

**ユーザーストーリー:** ユーザーとして、データ取得中であることを視覚的に確認したい。

#### 受け入れ基準

1. プロフィールAPIにリクエストを送信している間、プロフィール表示画面は、ローディングスピナーを表示しなければならない
2. プロフィールAPIにリクエストを送信している間、プロフィール編集画面は、ローディングスピナーを表示しなければならない
3. ローディング中、プロフィール表示画面は、プロフィール情報を表示してはならない
4. ローディング中、プロフィール編集画面は、フォームを表示してはならない

### 要件12: 認証エラー時のリダイレクト

**ユーザーストーリー:** 未認証ユーザーとして、プロフィール画面にアクセスした場合、ログイン画面にリダイレクトされたい。

#### 受け入れ基準

1. プロフィール表示画面がマウントされたとき、プロフィール表示画面は、ローカルストレージにアクセストークンが存在するかを確認しなければならない
2. アクセストークンが存在しない場合、プロフィール表示画面は、ユーザーをログイン画面（`/login`）にリダイレクトしなければならない
3. プロフィール編集画面がマウントされたとき、プロフィール編集画面は、ローカルストレージにアクセストークンが存在するかを確認しなければならない
4. アクセストークンが存在しない場合、プロフィール編集画面は、ユーザーをログイン画面（`/login`）にリダイレクトしなければならない

### 要件13: アクセシビリティ対応

**ユーザーストーリー:** スクリーンリーダーを使用するユーザーとして、プロフィール画面を適切に操作し、情報を理解したい。

#### 受け入れ基準

1. ユーザー名入力フィールドは、`aria-label`属性「ユーザー名」を持たなければならない
2. アイコン画像は、`alt`属性「プロフィールアイコン」を持たなければならない
3. バリデーションエラーが表示されたとき、プロフィール編集画面は、エラーメッセージに`role="alert"`属性を設定しなければならない
4. 「保存」ボタンが無効化されている間、プロフィール編集画面は、`aria-disabled="true"`属性を設定しなければならない
5. ファイル選択ボタンは、`aria-label`属性「アイコン画像を選択」を持たなければならない

### 要件14: レスポンシブデザイン

**ユーザーストーリー:** モバイルデバイスユーザーとして、スマートフォンやタブレットでもプロフィール画面を快適に使用したい。

#### 受け入れ基準

1. プロフィール表示画面は、画面幅320px以上のすべてのデバイスで適切に表示されなければならない
2. プロフィール編集画面は、画面幅320px以上のすべてのデバイスで適切に表示されなければならない
3. モバイルデバイス（画面幅768px未満）では、プロフィール編集画面は、フォーム要素を縦方向に配置しなければならない
4. タブレットおよびデスクトップデバイス（画面幅768px以上）では、プロフィール編集画面は、フォームを中央に配置し、最大幅600pxに制限しなければならない
5. すべてのタッチ可能な要素（ボタン、リンク）は、最小タップ領域44x44pxを確保しなければならない

### 要件15: 画像の最適化

**ユーザーストーリー:** ユーザーとして、アイコン画像を高速に表示し、データ通信量を削減したい。

#### 受け入れ基準

1. プロフィール表示画面は、アイコン画像をNext.jsの`Image`コンポーネントを使用して表示しなければならない
2. アイコン画像は、適切なサイズ（幅・高さ128px）で表示されなければならない
3. アイコン画像の読み込み中、プロフィール表示画面は、プレースホルダー画像またはスケルトンローダーを表示しなければならない
4. プロフィール編集画面のプレビュー画像は、適切なサイズ（幅・高さ128px）で表示されなければならない

### 要件16: セキュリティ対策

**ユーザーストーリー:** セキュリティを重視するユーザーとして、プロフィール情報が安全に管理されることを望む。

#### 受け入れ基準

1. プロフィール編集画面は、アクセストークンをブラウザのコンソールログに出力してはならない
2. プロフィール編集画面は、プロフィールAPIへのリクエストをHTTPS経由で送信しなければならない
3. プロフィール編集画面は、S3へのアップロードをHTTPS経由で実行しなければならない
4. プロフィール表示画面は、他のユーザーのプロフィール情報を表示してはならない（自分のプロフィールのみ）

### 要件17: エラーリカバリー

**ユーザーストーリー:** ユーザーとして、エラーが発生した場合でも、簡単に再試行できるようにしたい。

#### 受け入れ基準

1. プロフィール表示画面でAPIエラーが発生したとき、プロフィール表示画面は、「再読み込み」ボタンを表示しなければならない
2. 「再読み込み」ボタンをクリックしたとき、プロフィール表示画面は、プロフィールAPIに再度リクエストを送信しなければならない
3. S3へのアップロードが失敗したとき、プロフィール編集画面は、「再試行」ボタンを表示しなければならない
4. 「再試行」ボタンをクリックしたとき、プロフィール編集画面は、アップロード処理を再実行しなければならない
