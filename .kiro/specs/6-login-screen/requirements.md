# 要件定義書

## はじめに

本ドキュメントは、投票ボードゲームアプリケーションのログイン画面機能の要件を定義します。ログイン画面は、登録済みユーザーがメールアドレスとパスワードを使用してアプリケーションにログインできるようにするフロントエンド機能です。この画面は、既存のログインAPI（`/auth/login`）と統合し、認証成功後にユーザーをアプリケーションのメイン画面に遷移させます。

## 用語集

- **ログイン画面**: ユーザーがメールアドレスとパスワードを入力して認証を行うUIコンポーネント
- **ログインAPI**: バックエンドの認証エンドポイント（`/auth/login`）
- **アクセストークン**: API認証用の短期間有効なJWTトークン（15分）
- **リフレッシュトークン**: 新しいアクセストークンを取得するために使用される長期間有効なトークン
- **認証状態**: ユーザーがログイン済みかどうかを示すアプリケーションの状態
- **フォームバリデーション**: ユーザー入力の妥当性をクライアント側で検証する処理
- **エラーメッセージ**: バリデーションエラーまたはAPI呼び出しエラーをユーザーに表示するテキスト
- **パスワードリセット画面**: パスワードを忘れたユーザーが新しいパスワードを設定するための画面
- **ユーザー登録画面**: 新規ユーザーがアカウントを作成するための画面

## 要件

### 要件1: ログインフォームの表示

**ユーザーストーリー:** 未認証ユーザーとして、ログインフォームを表示し、メールアドレスとパスワードを入力してログインしたい。

#### 受け入れ基準

1. ログイン画面は、メールアドレス入力フィールドを表示しなければならない
2. ログイン画面は、パスワード入力フィールドを表示しなければならない
3. ログイン画面は、ログインボタンを表示しなければならない
4. パスワード入力フィールドは、入力内容をマスク表示（`type="password"`）しなければならない
5. メールアドレス入力フィールドは、プレースホルダーテキスト「メールアドレス」を表示しなければならない
6. パスワード入力フィールドは、プレースホルダーテキスト「パスワード」を表示しなければならない

### 要件2: クライアント側フォームバリデーション

**ユーザーストーリー:** ユーザーとして、フォーム送信前に入力エラーを即座に確認し、正しい形式で入力できるようにしたい。

#### 受け入れ基準

1. メールアドレスフィールドが空の状態でログインボタンをクリックしたとき、ログイン画面は、エラーメッセージ「メールアドレスを入力してください」を表示しなければならない
2. パスワードフィールドが空の状態でログインボタンをクリックしたとき、ログイン画面は、エラーメッセージ「パスワードを入力してください」を表示しなければならない
3. メールアドレスフィールドに無効な形式のメールアドレスが入力された状態でログインボタンをクリックしたとき、ログイン画面は、エラーメッセージ「有効なメールアドレスを入力してください」を表示しなければならない
4. バリデーションエラーが存在する場合、ログイン画面は、ログインAPIを呼び出してはならない

### 要件3: ログインAPI呼び出し

**ユーザーストーリー:** ユーザーとして、有効な認証情報を入力してログインボタンをクリックし、アプリケーションにログインしたい。

#### 受け入れ基準

1. すべてのバリデーションが通過した状態でログインボタンをクリックしたとき、ログイン画面は、入力されたメールアドレスとパスワードを含むPOSTリクエストをログインAPIに送信しなければならない
2. ログインAPIリクエストを送信している間、ログイン画面は、ログインボタンを無効化しなければならない
3. ログインAPIリクエストを送信している間、ログイン画面は、ローディングインジケーター（スピナーまたは「ログイン中...」テキスト）を表示しなければならない
4. ログインAPIリクエストを送信している間、ログイン画面は、フォーム入力フィールドを無効化しなければならない

### 要件4: ログイン成功時の処理

**ユーザーストーリー:** ユーザーとして、ログインに成功したら、アプリケーションのメイン画面に遷移し、投票に参加したい。

#### 受け入れ基準

1. ログインAPIが200ステータスコードを返したとき、ログイン画面は、レスポンスからアクセストークン、リフレッシュトークン、ユーザー情報を取得しなければならない
2. ログイン画面は、アクセストークンとリフレッシュトークンをブラウザのローカルストレージに保存しなければならない
3. ログイン画面は、ユーザー情報（userId、email、username）をアプリケーションの認証状態に保存しなければならない
4. トークンとユーザー情報の保存が完了したとき、ログイン画面は、ユーザーをホーム画面（`/`）にリダイレクトしなければならない

### 要件5: ログイン失敗時のエラー表示

**ユーザーストーリー:** ユーザーとして、ログインに失敗した場合、その理由を明確に理解し、適切に対処したい。

#### 受け入れ基準

1. ログインAPIが401ステータスコードを返したとき、ログイン画面は、エラーメッセージ「メールアドレスまたはパスワードが正しくありません」を表示しなければならない
2. ログインAPIが429ステータスコードを返したとき、ログイン画面は、エラーメッセージ「ログイン試行回数が上限に達しました。しばらくしてから再度お試しください」を表示しなければならない
3. ログインAPIが500ステータスコードを返したとき、ログイン画面は、エラーメッセージ「サーバーエラーが発生しました。しばらくしてから再度お試しください」を表示しなければならない
4. ネットワークエラーが発生したとき、ログイン画面は、エラーメッセージ「ネットワークエラーが発生しました。インターネット接続を確認してください」を表示しなければならない
5. エラーメッセージを表示したとき、ログイン画面は、ログインボタンとフォーム入力フィールドを再度有効化しなければならない

### 要件6: パスワードリセットへのナビゲーション

**ユーザーストーリー:** ユーザーとして、パスワードを忘れた場合、パスワードリセット画面に簡単にアクセスしたい。

#### 受け入れ基準

1. ログイン画面は、「パスワードをお忘れですか？」リンクを表示しなければならない
2. 「パスワードをお忘れですか？」リンクをクリックしたとき、ログイン画面は、ユーザーをパスワードリセット画面（`/password-reset`）に遷移させなければならない

### 要件7: ユーザー登録へのナビゲーション

**ユーザーストーリー:** 新規ユーザーとして、アカウントを持っていない場合、ユーザー登録画面に簡単にアクセスしたい。

#### 受け入れ基準

1. ログイン画面は、「アカウントをお持ちでない方」テキストと「新規登録」リンクを表示しなければならない
2. 「新規登録」リンクをクリックしたとき、ログイン画面は、ユーザーをユーザー登録画面（`/register`）に遷移させなければならない

### 要件8: 認証済みユーザーのリダイレクト

**ユーザーストーリー:** 認証済みユーザーとして、ログイン画面にアクセスした場合、自動的にホーム画面にリダイレクトされたい。

#### 受け入れ基準

1. ログイン画面がマウントされたとき、ログイン画面は、ローカルストレージにアクセストークンが存在するかを確認しなければならない
2. 有効なアクセストークンが存在する場合、ログイン画面は、ユーザーをホーム画面（`/`）にリダイレクトしなければならない
3. リダイレクト処理中、ログイン画面は、ローディングインジケーターを表示しなければならない

### 要件9: パスワード表示切り替え

**ユーザーストーリー:** ユーザーとして、入力したパスワードを確認するために、パスワードの表示/非表示を切り替えたい。

#### 受け入れ基準

1. パスワード入力フィールドの右側に、パスワード表示切り替えボタン（目のアイコン）を表示しなければならない
2. パスワード表示切り替えボタンをクリックしたとき、ログイン画面は、パスワードを平文で表示しなければならない
3. パスワードが平文表示されている状態でパスワード表示切り替えボタンをクリックしたとき、ログイン画面は、パスワードをマスク表示に戻さなければならない
4. パスワード表示切り替えボタンは、現在の表示状態を示すアイコン（表示中は「目を閉じた」アイコン、非表示中は「目を開いた」アイコン）を表示しなければならない

### 要件10: アクセシビリティ対応

**ユーザーストーリー:** スクリーンリーダーを使用するユーザーとして、ログインフォームを適切に操作し、エラーメッセージを理解したい。

#### 受け入れ基準

1. メールアドレス入力フィールドは、`aria-label`属性「メールアドレス」を持たなければならない
2. パスワード入力フィールドは、`aria-label`属性「パスワード」を持たなければならない
3. バリデーションエラーが表示されたとき、ログイン画面は、エラーメッセージに`role="alert"`属性を設定しなければならない
4. ログインボタンが無効化されている間、ログイン画面は、`aria-disabled="true"`属性を設定しなければならない
5. パスワード表示切り替えボタンは、`aria-label`属性「パスワードを表示」または「パスワードを非表示」を持たなければならない

### 要件11: レスポンシブデザイン

**ユーザーストーリー:** モバイルデバイスユーザーとして、スマートフォンやタブレットでもログイン画面を快適に使用したい。

#### 受け入れ基準

1. ログイン画面は、画面幅320px以上のすべてのデバイスで適切に表示されなければならない
2. モバイルデバイス（画面幅768px未満）では、ログイン画面は、フォーム要素を縦方向に配置しなければならない
3. タブレットおよびデスクトップデバイス（画面幅768px以上）では、ログイン画面は、フォームを中央に配置し、最大幅400pxに制限しなければならない
4. すべてのタッチ可能な要素（ボタン、リンク）は、最小タップ領域44x44pxを確保しなければならない

### 要件12: セキュリティ対策

**ユーザーストーリー:** セキュリティを重視するユーザーとして、ログイン処理が安全に行われ、認証情報が保護されることを望む。

#### 受け入れ基準

1. ログイン画面は、パスワードをブラウザのコンソールログに出力してはならない
2. ログイン画面は、パスワードをURLパラメータに含めてはならない
3. ログイン画面は、ログインAPIへのリクエストをHTTPS経由で送信しなければならない
4. ログイン画面は、アクセストークンとリフレッシュトークンをローカルストレージに保存する際、XSS攻撃を防ぐために適切なサニタイゼーションを行わなければならない
