# Implementation Plan: ユーザー登録画面

## 概要

本実装計画は、投票ボードゲームアプリケーションのユーザー登録画面機能を実装するためのタスクリストです。この機能は、新規ユーザーがメールアドレスとパスワードを使用してアカウントを作成できるフロントエンド画面を提供します。実装は既存のユーザー登録API（spec 1）と統合し、Next.js 16、TypeScript、Tailwind CSS、shadcn/ui、Vitestを使用します。

## タスク

- [x] 1. プロジェクト構造とコアインターフェースのセットアップ
  - packages/web/src/app/register/ディレクトリを作成
  - packages/web/src/components/auth/ディレクトリを作成
  - packages/web/src/lib/hooks/ディレクトリを作成（存在しない場合）
  - packages/web/src/lib/services/ディレクトリを作成（存在しない場合）
  - TypeScript型定義ファイルを作成（RegisterRequest, RegisterResponse, User, FormErrors）
  - 要件: 1.1, 1.2, 1.3, 1.4, 1.5

- [ ] 2. Auth Serviceの拡張
  - [x] 2.1 Auth Serviceにregisterメソッドを実装
    - packages/web/src/lib/services/auth-service.tsにregisterメソッドを追加
    - RegisterRequest型とRegisterResponse型を定義
    - POST /auth/registerエンドポイントへのAPI呼び出しを実装
    - HTTPステータスコード（409, 429, 500）に基づくエラーハンドリング
    - ネットワークエラーの検出と適切なエラーメッセージの返却
    - アクセストークンとリフレッシュトークンのローカルストレージへの保存
    - 要件: 3.1, 3.5, 3.6, 7.1, 7.2

  - [x] 2.2 Auth Serviceのregisterメソッドのユニットテストを作成
    - packages/web/src/lib/services/auth-service.test.tsを作成
    - 成功レスポンス（201）のテスト
    - エラーレスポンス（409, 429, 500）のテスト
    - ネットワークエラーのテスト
    - トークン保存の検証
    - 要件: 3.1, 3.5, 3.6

- [ ] 3. useRegisterフックの実装
  - [x] 3.1 useRegisterカスタムフックを作成
    - packages/web/src/lib/hooks/use-register.tsを作成
    - isLoading、error状態の管理
    - register関数の実装（Auth Serviceの呼び出し）
    - useAuthフックとの統合（ユーザー情報の保存）
    - エラーハンドリングとエラーメッセージの設定
    - 要件: 3.1, 3.2, 3.3, 3.5, 3.6

  - [x] 3.2 useRegisterフックのユニットテストを作成
    - packages/web/src/lib/hooks/use-register.test.tsxを作成
    - 登録成功フローのテスト
    - 登録失敗フローのテスト
    - ローディング状態の検証
    - エラー状態の検証
    - useAuthフックとの統合の検証
    - 要件: 3.1, 3.2, 3.3, 3.5, 3.6

- [ ] 4. RegisterFormコンポーネントの実装
  - [x] 4.1 RegisterFormコンポーネントの基本構造を作成
    - packages/web/src/components/auth/register-form.tsxを作成
    - メールアドレス、パスワード、パスワード確認の入力フィールドを実装
    - 登録ボタンとログインリンクを実装
    - shadcn/uiのInput、Button、Alertコンポーネントを使用
    - 要件: 1.1, 1.2, 1.3, 1.4, 1.5

  - [x] 4.2 クライアント側バリデーションを実装
    - メールアドレス形式のバリデーション関数（validateEmail）
    - パスワード要件のバリデーション関数（validatePassword）
    - パスワード確認のバリデーション関数（validatePasswordConfirmation）
    - onBlurイベントでのバリデーション実行
    - エラーメッセージの表示とフィールドのスタイリング
    - バリデーションエラー時の登録ボタン無効化
    - 要件: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7

  - [x] 4.3 パスワード表示切り替え機能を実装
    - パスワードフィールドとパスワード確認フィールドの表示切り替えボタン
    - showPassword、showPasswordConfirmation状態の管理
    - Eye/EyeOffアイコン（lucide-react）の使用
    - type属性の動的切り替え（password/text）
    - 要件: 4.1, 4.2, 4.3, 4.4, 4.5

  - [x] 4.4 登録フォーム送信処理を実装
    - handleSubmit関数の実装
    - フォーム全体のバリデーション
    - useRegisterフックの呼び出し
    - 登録成功時の/email-verificationへのナビゲーション
    - APIエラーメッセージの表示
    - ローディング状態の管理
    - 要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6

  - [x] 4.5 アクセシビリティ対応を実装
    - すべての入力フィールドにaria-label属性を追加
    - エラーメッセージとフィールドをaria-describedby属性で関連付け
    - エラーメッセージにrole="alert"属性を追加
    - aria-invalid属性の動的設定
    - キーボードナビゲーションの確保
    - 要件: 5.1, 5.2, 5.3, 5.4, 5.5

  - [x] 4.6 レスポンシブデザインを実装
    - モバイル、タブレット、デスクトップでの最適なレイアウト
    - Tailwind CSSのレスポンシブクラスを使用
    - タッチ可能要素の最小サイズ（44x44px）を確保
    - 単一カラムレイアウト（モバイル）
    - 要件: 6.1, 6.2, 6.3

  - [~] 4.7 RegisterFormコンポーネントのユニットテストを作成
    - packages/web/src/components/auth/register-form.test.tsxを作成
    - 初期表示のテスト（フォーム要素の存在確認）
    - バリデーションエラーの表示テスト
    - ローディング状態のUI変更テスト
    - 登録成功フローのテスト
    - ログインリンクのテスト
    - パスワード表示切り替えのテスト
    - ARIA属性のテスト
    - レスポンシブレイアウトのテスト
    - 要件: 1.1-1.5, 2.1-2.7, 3.1-3.6, 4.1-4.5, 5.1-5.5, 6.1-6.3

- [~] 5. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、質問があればユーザーに尋ねる

- [ ] 6. RegisterPageコンポーネントの実装
  - [~] 6.1 RegisterPageコンポーネントを作成
    - packages/web/src/app/register/page.tsxを作成
    - 認証済みユーザーのリダイレクト処理（トークン存在確認）
    - RegisterFormコンポーネントのレンダリング
    - ローディング状態の表示
    - ページタイトルと説明の表示
    - 要件: 1.1, 1.2, 1.3, 1.4, 1.5

  - [~] 6.2 RegisterPageコンポーネントのユニットテストを作成
    - packages/web/src/app/register/page.test.tsxを作成
    - 認証済みユーザーのリダイレクトテスト
    - 未認証ユーザーのフォーム表示テスト
    - ローディング状態の表示テスト
    - 要件: 1.1, 1.2, 1.3, 1.4, 1.5

- [ ] 7. プロパティベーステストの実装
  - [~] 7.1 プロパティ1のテストを作成: メールアドレス形式検証
    - packages/web/src/components/auth/register-form.property.test.tsxを作成
    - fast-checkを使用してランダムなメールアドレス入力を生成
    - 無効なメール形式に対するエラーメッセージの表示を検証
    - プロパティ1: メールアドレス形式検証
    - 検証: 要件 2.1, 2.2

  - [~] 7.2 プロパティ2のテストを作成: パスワード要件検証
    - 8文字未満のパスワードに対するエラーメッセージの表示を検証
    - プロパティ2: パスワード要件検証
    - 検証: 要件 2.3, 2.4

  - [~] 7.3 プロパティ3のテストを作成: パスワード確認検証
    - 一致しないパスワードとパスワード確認に対するエラーメッセージの表示を検証
    - プロパティ3: パスワード確認検証
    - 検証: 要件 2.5, 2.6

  - [~] 7.4 プロパティ4のテストを作成: バリデーションエラー時のボタン無効化
    - バリデーションエラーが存在する場合の登録ボタン無効化を検証
    - プロパティ4: バリデーションエラー時のボタン無効化
    - 検証: 要件 2.7

  - [~] 7.5 プロパティ5のテストを作成: 有効な入力でのAPI呼び出し
    - 有効なメールアドレスとパスワードでのAPI呼び出しを検証
    - プロパティ5: 有効な入力でのAPI呼び出し
    - 検証: 要件 3.1

  - [~] 7.6 プロパティ6のテストを作成: 登録成功時のナビゲーション
    - 登録成功時の/email-verificationへの遷移を検証
    - プロパティ6: 登録成功時のナビゲーション
    - 検証: 要件 3.4

  - [~] 7.7 プロパティ7のテストを作成: APIエラーメッセージの表示
    - 各種APIエラー（409, 429, 500、ネットワークエラー）に対するエラーメッセージの表示を検証
    - プロパティ7: APIエラーメッセージの表示
    - 検証: 要件 3.5, 3.6

  - [~] 7.8 プロパティ8のテストを作成: パスワード表示切り替えのラウンドトリップ
    - パスワード表示切り替えボタンを2回クリックした際の元の状態への復帰を検証
    - プロパティ8: パスワード表示切り替えのラウンドトリップ
    - 検証: 要件 4.3

  - [~] 7.9 プロパティ9のテストを作成: aria-describedbyによるエラーメッセージの関連付け
    - エラーメッセージとフィールドのaria-describedby属性による関連付けを検証
    - プロパティ9: aria-describedbyによるエラーメッセージの関連付け
    - 検証: 要件 5.2

  - [~] 7.10 プロパティ10のテストを作成: バリデーションエラーのスクリーンリーダー通知
    - エラーメッセージのrole="alert"属性を検証
    - プロパティ10: バリデーションエラーのスクリーンリーダー通知
    - 検証: 要件 5.5

  - [~] 7.11 プロパティ11のテストを作成: タッチ可能要素の最小サイズ
    - インタラクティブ要素の最小タップ領域（44x44px）を検証
    - プロパティ11: タッチ可能要素の最小サイズ
    - 検証: 要件 6.2

  - [~] 7.12 プロパティ12のテストを作成: パスワードのローカルストレージ非保存
    - パスワードとパスワード確認がローカルストレージに保存されないことを検証
    - プロパティ12: パスワードのローカルストレージ非保存
    - 検証: 要件 7.2

- [~] 8. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、質問があればユーザーに尋ねる

## 注意事項

- `*`マークが付いたタスクはオプションであり、MVPでは省略可能です
- 各タスクは前のタスクに基づいて構築されます
- プロパティベーステストは設計ドキュメントのプロパティを参照します
- チェックポイントで段階的な検証を行います
- すべてのコードはTypeScriptで記述します
- Next.js 16のApp Routerを使用します
- shadcn/uiコンポーネントを活用します
- Vitestでテストを実行します
